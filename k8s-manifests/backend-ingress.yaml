# eks-terraform/kubernetes_manifests/backend-ingress.yaml

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: onthetop-backend-ingress
  # 이 어노테이션들이 AWS Load Balancer Controller에게 일을 시키는 부분입니다.
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
spec:
  rules:
    # 1. ArgoCD 접속 규칙
    - host: argocd.onthe-top.com  # ⚠️ ArgoCD에 사용할 실제 도메인으로 변경
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: argocd-server # ArgoCD 서비스 이름
                port:
                  number: 80 # argocd-server가 노출하는 HTTP 포트

    # 2. 백엔드 서비스 접속 규칙
    - host: api.your-domain.com  # ⚠️ 백엔드 서비스에 사용할 실제 도메인으로 변경
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                # 🚨 백엔드 서비스는 다른 네임스페이스에 있으므로,
                # '네임스페이스이름.서비스이름' 형태로 접근해야 할 수 있습니다.
                # 여기서는 'default' 네임스페이스에 있다고 가정합니다.
                name: onthetop-backend-service # 백엔드 서비스 이름
                port:
                  number: 80 # onthetop-backend-service가 노출하는 포트
